" Load vim-pathogen
execute pathogen#infect()

" Generic configuration
syntax on
set nocompatible
set number
set ruler
set encoding=utf-8 " Necessary to show Unicode glyphs
set clipboard=unnamed,unnamedplus

if has("autocmd")
  filetype indent plugin on
endif

" remap the leader key
let mapleader=','

" Whitespace and tabs
set nowrap                        " don't wrap lines
set tabstop=2                     " a tab is two spaces
set shiftwidth=2                  " an autoindent (with <<) is two spaces
set expandtab                     " use spaces, not tabs
"set list                          " Show invisible characters
set backspace=indent,eol,start    " backspace through everything in insert mode

" Setup splitting where I want it
set splitbelow
set splitright

" Searching
" set hlsearch    " highlight matches
set incsearch   " incremental searching
set ignorecase  " searches are case insensitive...
set smartcase   " ... unless they contain at least one capital letter

nnoremap <Leader>sw /<C-R>=expand('<cword>')<CR><CR>
nnoremap <Leader>sd /def <C-R>=expand('<cword>')<CR><CR>

" allow for %% to be the path of the current file
cabbr <expr> %% expand('%:p:h')

" Get the mouse working on terminal vim
" set ttyfast
" set mouse=a
" set ttymouse=xterm2

" Splits navigation
nmap <silent> <c-k> :wincmd k<CR>
nmap <silent> <c-j> :wincmd j<CR>
nmap <silent> <c-h> :wincmd h<CR>
nmap <silent> <c-l> :wincmd l<CR>

" Color Scheme
set background=dark
if has('gui_running')
  let g:solarized_termtrans=0
else
  let g:solarized_termtrans=1
end
let g:solarized_bold=0
let g:solarized_visibility="high"
let g:solarized_termcolors=256
let g:solarized_contrast="normal"
colorscheme solarized

" Configure vim-airline
let g:airline_theme="solarized"
let g:airline_powerline_fonts=1
set laststatus=2   " always show the status line
let g:airline#extensions#tmuxline#enabled = 0 " turn off the theme integration with tmuxline

" Configure vim-tmuxline
let g:tmuxline_theme='iceberg'

" Configure vim-fugitive
nmap <silent> <leader>gb :Gblame<CR>
nmap <silent> <leader>gs :Gstatus<CR>
nmap <silent> <leader>gd :Gdiff<CR>
nmap <silent> <leader>gl :Glog<CR>
nmap <silent> <leader>gc :Gcommit<CR>
nmap <silent> <leader>gp :Gpush<CR>

" Configure vim-syntastic
let g:syntastic_enable_signs=1
"let g:syntastic_quiet_messages={'level': 'warnings'}
let g:syntastic_auto_loc_list=2

" Configure vim-coffee-script
vmap <leader>bb <esc>:'<,'>:CoffeeCompile<CR>
map <leader>bb :CoffeeCompile<CR>

" Configure vim-ruby-xmpfilter
map <Leader>rs <Plug>(xmpfilter-mark)
map <Leader>rr <Plug>(xmpfilter-run)

" Configure vim-ctrlp (not currently in use)
let g:ctrlp_custom_ignore = {
            \ 'dir': '\.git$\|node_modules$\|\.hg$\|\.svn$',
            \ 'file': '\.exe$\|\.so$'
            \ }

" Configure Vroom
let g:vroom_use_vimux=1
let g:vroom_use_bundle_exec=0
let g:vroom_test_unit_command="testrbl" " make sure to run `gem install testrbl`

" Configure vimux
map <Leader>vp :VimuxPromptCommand<CR>
map <Leader>vl :VimuxRunLastCommand<CR>
map <Leader>vi :VimuxInspectRunner<CR>
map <Leader>vq :VimuxCloseRunner<CR>

" Configure Ack
nnoremap <leader>a :Ack! 
let g:ack_default_options = " -s -H --nocolor --nogroup --column --ignore-dir=tmp --ignore-dir=log"

" Configure file types
au BufNewFile,BufRead *.ejs set filetype=html

" Setup ignores (Taken from https://github.com/carlhuda/janus)
" Disable output and VCS files
set wildignore+=*.o,*.out,*.obj,.git,*.rbc,*.rbo,*.class,.svn,*.gem

" Disable archive files
set wildignore+=*.zip,*.tar.gz,*.tar.bz2,*.rar,*.tar.xz

" Ignore bundler and sass cache
set wildignore+=*/vendor/gems/*,*/vendor/cache/*,*/.bundle/*,*/.sass-cache/*

" Ignore librarian-chef, vagrant, test-kitchen and Berkshelf cache
set wildignore+=*/tmp/librarian/*,*/.vagrant/*,*/.kitchen/*,*/vendor/cookbooks/*

" Ignore rails temporary asset caches
set wildignore+=*/tmp/cache/assets/*/sprockets/*,*/tmp/cache/assets/*/sass/*

" Disable temp and backup files
set wildignore+=*.swp,*~,._*

" Backup and swap files
set backupdir^=~/.vim/_backup//    " where to put backup files.
set directory^=~/.vim/_temp//      " where to put swap files.
